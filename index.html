<!DOCTYPE html>
<html>
<head>
  <title>我的温度数据</title>
  <!-- 引入Chart.js库 -->
  <script src="^1^"></script>
  <!-- 设置网页样式 -->
  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    #chart {
      width: 800px;
      height: 400px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <!-- 显示网页标题 -->
  <h1>我的温度数据</h1>
  <!-- 显示最新的温度值 -->
  <p id="temp">正在获取温度数据...</p>
  <!-- 显示温度折线图 -->
  <canvas id="chart"></canvas>
  <!-- 嵌入JavaScript代码 -->
  <script>
    // 定义一个数组，用来存储温度数据
    var data = [];
    // 定义一个函数，用来创建一个Chart.js对象
    function createChart() {
      // 获取canvas元素
      var ctx = document.getElementById("chart").getContext("2d");
      // 创建一个Chart.js对象
      var chart = new Chart(ctx, {
        // 设置图表类型为折线图
        type: "line",
        // 设置图表数据
        data: {
          // 设置x轴标签为时间
          labels: data.map(function(d) { return d.time; }),
          // 设置y轴数据为温度值
          datasets: [{
            label: "温度（℃）",
            data: data.map(function(d) { return d.temp; }),
            fill: false,
            borderColor: "blue",
            pointRadius: 2
          }]
        },
        // 设置图表选项
        options: {
          scales: {
            xAxes: [{
              type: "time",
              time: {
                unit: "second"
              }
            }]
          }
        }
      });
      // 返回Chart.js对象
      return chart;
    }
    // 定义一个函数，用来更新图表数据
    function updateChart(chart) {
      // 更新x轴标签为时间
      chart.data.labels = data.map(function(d) { return d.time; });
      // 更新y轴数据为温度值
      chart.data.datasets[0].data = data.map(function(d) { return d.temp; });
      // 刷新图表显示
      chart.update();
    }
    // 定义一个函数，用来获取webhook发送过来的数据
    function getData() {
      // 创建一个XMLHttpRequest对象
      var xhr = new XMLHttpRequest();
      // 设置请求方法为GET，请求地址为webhook URL
      xhr.open("GET", "https://webhook.site/fbda7154-9421-4ab1-8570-a3eabbc605af");
      // 设置请求头为JSON格式
      xhr.setRequestHeader("Content-Type", "application/json");
      // 设置请求完成后的回调函数
      xhr.onload = function() {
        // 如果请求成功
        if (xhr.status == 200) {
          // 解析响应数据为JSON对象
          var response = JSON.parse(xhr.responseText);
          // 获取温度值
          var temp = response.temperature;
          // 获取当前时间
          var time = new Date();
          // 在网页上显示最新的温度值
          document.getElementById("temp").innerHTML = "最新的温度值为：" + temp + "℃";
          // 将温度值和时间添加到数据数组中
          data.push({temp: temp, time: time});
          // 如果数据数组的长度超过10，删除最早的数据
          if (data.length > 10) {
            data.shift();
          }
          // 更新图表数据
          updateChart(chart);
        }
      };
      // 发送请求
      xhr.send();
    }
    // 创建一个图表对象
    var chart = createChart();
    // 每隔5秒调用一次getData函数，获取最新的数据
    setInterval(getData, 5000);
  </script>
</body>
</html>
